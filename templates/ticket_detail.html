{% extends "base.html" %}
{% block content %}

<h2>Ticket #{{ ticket.id }} - {{ ticket.title }}</h2>

<div class="card shadow mt-4">
    <div class="card-body">

        <p><strong>User:</strong> {{ ticket.username }}</p>
        <p><strong>Status:</strong> {{ ticket.status }}</p>
        <p><strong>Priority:</strong> {{ ticket.priority }}</p>
        <p><strong>Description:</strong></p>

        <div class="border p-3 bg-white">
            {{ ticket.description }}
        </div>

        <!-- DELETE TICKET BUTTON (ADMIN/AGENT ONLY) -->
        {% if session.role in ["ADMIN", "AGENT"] %}
        <form action="/tickets/{{ ticket.id }}/delete" method="POST" 
              onsubmit="return confirm('Delete this ticket permanently?');">
            <button class="btn btn-danger mt-3">Delete Ticket</button>
        </form>
        {% endif %}

    </div>
</div>

<h3 class="mt-4">Comments</h3>

<div class="card shadow mt-3">
    <div class="card-body">

        {% for c in comments %}
        <div class="border-bottom pb-2 mb-3">
            <p><strong>{{ c.username }}</strong> â€¢ {{ c.created_at }}</p>
            <p>{{ c.comment }}</p>
        </div>
        {% endfor %}

        <hr>

        <form method="POST">
            <textarea name="comment" class="form-control mb-3" rows="3"
                      placeholder="Write a comment..." required></textarea>
            <button class="btn btn-primary">Add Comment</button>
        </form>

    </div>
</div>

{% endblock %}

